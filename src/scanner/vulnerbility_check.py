import subprocess
import os

USERNAME_LIST_PATH = os.path.join(os.path.dirname(__file__),"/home/yuya/network_vulnerability_assessment_tool/src/utils/user.txt")
PASSWORD_LIST_PATH = os.path.join(os.path.dirname(__file__),"/home/yuya/network_vulnerability_assessment_tool/src/utils/password.txt")


def check_ssh_vulnerbility(ip):
    try:
        print(ip)
        cmd = [
            "hydra",
            "-L",USERNAME_LIST_PATH,
            "-P",PASSWORD_LIST_PATH,
            "f",
            "-t","4",
            "-vV",
            ip,"ssh"
        ]
        result = subprocess.run(cmd,stdout=subprocess.PIPE,stderr=subprocess.PIPE,text=True)
        print(result)
        if "0 valid passwords found" in result.stdout:
            return "Secure"
        else:
            return "Vulnerble"
    except Exception as e:
        return str(e)

def check_telnet_vulnerbility(ip):
    try:
        print(ip)
        cmd = [
            "hydra",
            "-L",USERNAME_LIST_PATH,
            "-P",PASSWORD_LIST_PATH,
            "f",
            "-t","4",
            "-vV",
            ip,"telnet"
        ]
        result = subprocess.run(cmd,stdout=subprocess.PIPE,stderr=subprocess.PIPE,text=True)
        print(result)
        if "0 valid passwords found" in result.stdout:
            return "Secure"
        else:
            return "Vulnerble"
    except Exception as e:
        return str(e)

print(check_telnet_vulnerbility("192.168.11.5"))