import subprocess
import os
from src.scanner.port_scan import is_ssh_open,is_telnet_open

USERNAME_LIST_PATH = os.path.join(os.path.dirname(__file__),"/home/yuya/network_vulnerability_assessment_tool/src/utils/user.lst")
PASSWORD_LIST_PATH = os.path.join(os.path.dirname(__file__),"/home/yuya/network_vulnerability_assessment_tool/src/utils/password.lst")


def check_ssh_vulnerbility(ip):
    if not is_ssh_open(ip):
        return "Secure"
    try:
        cmd = [
            "hydra",
            "-f",
            "-L",USERNAME_LIST_PATH,
            "-P",PASSWORD_LIST_PATH,
            "-t","4",
            "-vV",
            ip,"ssh"
        ]
        result = subprocess.run(cmd,stdout=subprocess.PIPE,stderr=subprocess.PIPE,text=True)
        if "1 valid password found" in result.stdout:
            return "Vulnerble"
        else:
            return "Secure"
    except Exception as e:
        return str(e)

def check_telnet_vulnerbility(ip):
    if not is_telnet_open(ip):
        return "Secure"
    try:
        cmd = [
            "hydra",
            "-f",
            "-L",USERNAME_LIST_PATH,
            "-P",PASSWORD_LIST_PATH,
            "-t","4",
            "-vV",
            ip,"telnet"
        ]
        result = subprocess.run(cmd,stdout=subprocess.PIPE,stderr=subprocess.PIPE,text=True)
        print(result)
        if "1 valid password found" in result.stdout:
            return "Vulnerble"
        else:
            return "Secure"
    except Exception as e:
        return str(e)
