from scapy.all import ARP,Ether,srp
import netifaces

def network():
    global SCAN
    rec = ""
    clients = []
    target_IP = "192.168.11.1/24"
    #create ARP packets
    arp = ARP(pdst=target_IP)
    #create the Ether bradcast packets
    ether = Ether(dst="ff:ff:ff:ff:ff:ff")
    #stack them
    packet = ether/arp
    result = srp(packet,timeout=3)[0]
    for sent,received in result:
        clients.append({"ip":received.psrc,"mac":received.hwsrc})
    #print clients
    for client in clients:
        rec += "{:16}    {}".format(client["ip"],client["mac"]) + "\n"
    SCAN = "無線LAN内の機器\n" + "IP" + " "*28+"MAC\n"+ rec
    #return SCAN
    return clients

print(network())