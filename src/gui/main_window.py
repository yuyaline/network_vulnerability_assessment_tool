# home/yuya/network_vulnerability_assessment_tool/venv/bin/python /home/yuya/network_vulnerability_assessment_tool/src/gui/main_window.py

import PySimpleGUI as sg
import sys
sys.path.append('/home/yuya/network_vulnerability_assessment_tool')
from scapy.all import ARP,Ether,srp
from src.scanner.network_scan import *
from src.scanner.Device import *


sg.theme("SystemDefault1")


DEVICES = []


def start_screen():
    
    layout = [
        [sg.Text("network_vulnerability_assessment_tool")],
        [sg.Button("Start network-scan",key="-SCAN-")],
        [sg.Button("exit",key="-EXIT-")]
    ]

    window = sg.Window("network_tester",layout)

    while True:
        event,value = window.read()

        if event in (sg.WINDOW_CLOSED,"-EXIT-"):
            break
        elif event in ("-SCAN-"):
            window.close()
            lan_scan_screen()
    
    window.close()

def lan_scan_screen():
    scan_results = scan()

    for ip,mac  in scan_results:
        device = Device(ip,mac)
        DEVICES.append(device)


    header = ["IP Address","MAC Address"]

    data = [[result["ip"],result["mac"]] for result in scan_results]

    layout = [
        [sg.Text("Scan result")],
        [sg.Table(
            values=data,
            headings=header,
            #display_row_numbers=True,
            auto_size_columns=True,
            justification="right",
            #num_rows=(25,len(data))
        )],
        [sg.Button("vulnerability_check",key="-CHECK-")],
        [sg.Button("exit",key="-EXIT-")]
    ]    

    window = sg.Window("VulnerbleCheck result screen",layout)

    while True:
        event,value = window.read()
        if event in (sg.WIN_CLOSED,"-EXIT-"):
            break
        elif event == "-CHECK-":
            window.close()
            vulnerability_check_screen()

    window.close()

def vulnerability_check_screen():
    
    pass


if __name__ == "__main__":
    start_screen()